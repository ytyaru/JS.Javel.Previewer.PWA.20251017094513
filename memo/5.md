# Javelファイル出力形式パターン網羅

　ページ分割処理をしたあとでJavelファイル出力可能な機能を追加したい。このときページ分割に関するメタデータを追記した形式も選べるようにしたい。どのようなパターンがありうるか考えて網羅したい。

* ページ分割データ
    * なし：環境依存値であるページ分割データを排除することでネットに公開するオフィシャルなデータを生成できる
    * あり：自分の環境や好みに特化した設定を記録し、ページ分割処理を高速化する

* ページ分割データ
    * 一切なし
    * CSSページ設定値
        * ページ計算に関係する（閲覧時に変更不可）
            * 画面サイズ
            * 全画面化是非
            * 書字方向
            * 文字サイズ（最終的な文字サイズ、最低保証サイズpx/字、最長字／行）
            * 段組み（段数、gap）
            * 余白（行間、字間）
            * フォントファミリ
        * ページ計算に無関係であり閲覧時に自由に変更可能
            * フッタ設定
            * ライト／ダーク
    * 分割開始位置
        * `bi`: block-index（テキストブロック番号）
        * `si`: split-index（ブロック内分割番号（長いブロックがページ間をまたいだとき別のHTML要素に分割されるが、それらは原稿上同一ブロックであることを示しつつ、`bi`だけだと一意にHTML要素を区別できないことから、`si`を用意する））
        * `ni`: node-index（ブロック内ノード番号。ElementNode/TextNodeの二種類あり、TextNodeはHTML要素がなく属性値もないため原稿上の字数位置を残せない。もし間に`<ruby>`や`<em>`がくれば、単純なinnerHTML内字数だけでは原稿内字数と齟齬が起きる。そもそもJavel書式が`｜漢字《かんじ》`のようにHTMLでは表示しないメタ文字を含んでいる。これらを解決して原稿上の場所を特定するためには、まずノードの場所を指定する必要がある。それが`ni`）
        * `mi`: Manuscript-Index（`<ruby>`,`<em>`のようなElementNodeが持つ原稿上の開始位置を示す値。）
        * `ml`: Manuscript-Length（`<ruby>`,`<em>`のようなElementNodeが持つ原稿上の長さを示す値。）
        * `piped`: （`<ruby>`が持つ真偽値の属性で、開始位置を示すパイプ｜があるか否かを示す。HTMLからJavel原稿を復元するときに使う）

