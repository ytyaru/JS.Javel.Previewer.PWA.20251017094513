<!DOCTYPE html>
<head>
<meta charset="utf8">
</head>
<body>
<button id="full">APIによる全画面切替</button>
<p>F11キー押下とボタン押下を混在させると、全画面切替できなくなる。再現手順は以下。</p>
<ol>
  <li>ボタン押下で全画面化する
  <li>F11キーで元に戻す
  <li>F11キーで全画面化する
</ol>
<p>3でエラー発生する。</p>
<pre><code>TypeError: Fullscreen request denied</code></pre>全画面化もしない。
<p>ボタンだけ、または、F11キーだけなら正常に動作する。混在させるとF11キーは２往復目から動作しなくなる。動作確認するときはリロードして最初からやり直すこと。</p>
<p>ブラウザによって変わるかもしれない。動作確認したブラウザはFirefox141。</p>
<script>
window.addEventListener('DOMContentLoaded', async(event) => {
    const button = document.querySelector('#full');
    // クリックイベント
    button.addEventListener('click', (e)=>{
        toggleFullScreen();
    });
    // キーイベント
    window.addEventListener('keydown', (e)=>{
        if ('F11'===e.key) {e.preventDefault();}
    });
    window.addEventListener('keyup', (e)=>{
        if ('F11'===e.key) {
            e.preventDefault(); // デフォルト処理を抑制する  
            toggleFullScreen(); // 全画面切替
        }
    });
    // 全画面切替
    function toggleFullScreen() {
        if (document.fullscreenElement) { document.exitFullscreen();
        } else {
            if (document.documentElement.requestFullscreen) {
                document.documentElement.requestFullscreen();
            }
        }
    }
});
</script>
</body>
