# ToDo 2025-10-21

- [ ] バグ
    - [x] ライト／ダークをキーボード入力で変更させる機能忘れ追加
- [ ] リファクタリング
    - [x] JS
        - [x] columnCount=1時のフッタ部分をサイズ縮小でなく余白に変更する
    - [x] CSS
        - [x] index.html内にある`<style>`を整理する
        - [x] style.cssに移す（index.htmlの外に出す）
        - [x] サニタイズCSSを適用する（https://qiita.com/sfp_waterwalker/items/30d5c48b64d887269c89）
    - [ ] HTML
        - [x] ページ設定のフォント統一のため`<label>`を使う
        - [ ] オーバーレイは本当に`<div>`要素を必要とするか？　削除できるなら削除したい
        - [ ] 水平線hr
            - [ ] 見た目上の区切りならCSSの`border`でいいのでは？　どっちがいい？　「文書の構造上、主題が変わったことを表す」時にhrを使うべき。内容が論理的に変わる時。
                - [ ] index.html
                    - 特徴では前者が要約、後者が詳細である
                    - 方針では前者がポジティブ表現、後者がネガティブ表現である
                - [ ] 内容が論理的に変わったので適切／そもそも文書でなくカードであり単語であるため不適切。どう判断する？
        - [ ] セクショニング
            - [ ] `div`だけでなく`header`,`footer`,`main`,`section`を活用したい
        - [ ] 識別子
            - [ ] `id`/`name`どちらを使うか特定の法則を定義し根拠とともに明文化たい
        - [ ] 親子関係(`<div>`用途の特定と命名規則)
            - [ ] CSSで配置する用／その要素を一意に特定する用／その要素を分類する用
            - [ ] できればWebComponent化したい
        - [ ] 原稿を外部参照にする（index.htmlの外に出す）
    - [ ] アイコン
        - [ ] SVG Spriteに変更する（index.htmlの外に出す）
        - [ ] フォントファイル化する
            - [ ] fontconvでSVGからWOFF2を作成する（https://ytyaru.hatenablog.com/entry/2025/04/11/000000）
- [ ] パフォーマンス
    - [ ] ローディング中に作成済みページを閲覧するとページ分割計算がバグって空ページが大量生産されてしまう問題の原因究明（原因不明のため究明したい。PWAのWorkerでもdocumentにアクセス不能のため解決不能）
    - [ ] ページ遷移
        - [ ] `display:none/block`切替時、初回だけ表示が遅い（`css display block none 初回時 時間がかかる`。原因はリフローによる計算が発生するから。対象要素以降に存在する全要素数に比例して遅くなる。代わりに`visibility: hidden/visible`を使うか検討する。但し非表示領域がスペース占領するためスクロールが表示されてしまう。`transform: scale(0/1);`と`opacity: 0/1;`で代用する）
            - [ ] 同様にappHeaderの表示／非表示も遅い（こちらはvisibilityを使うわけには行かない。オーバーレイでモーダル画面を出すなどの工夫が必要）
    - [ ] 調査
        - [ ] ページ表示方法の最適化調査（`display:none`か`visibility:hidden`か）
        - [ ] ページめくりアニメーション
- [ ] アイコン
    - [ ] ライセンス用アイコン追加
        - [ ] CC系7種類
        - [ ] コピーレフト（AGPL, GPL）
        - [ ] 準コピーレフト（MPL, LGPL）
        - [ ] 非コピーレフト（MIT, Apatch2.0, BSD）
- [ ] ユーザビリティ
    - [ ] ユーザ入力表示
        - [ ] `<kbd>`（終了タグの省略は不可）
            - [ ] キーボード
                - [ ] キー表示
                    - [ ] `Win` Windows
                    - [ ] `⌘` Mac Command https://note.com/apple_training/n/nf6372ceef874
                        - [ ] Option (⌥ オプション)
                        - [ ] Control (⌃ コントロール)
                    - [ ] `⇧`Shift
                    - [ ] `⌤` (enter)
                    - [ ] `⎋` (escape)
                    - [ ] ⇟ (page down) / ⇞ (page up)
                    - [ ] ↖ (home) / ↘ (end)
                    - [ ] ↩ (return) / ↑↓←→ / ⌫ (delete) / ⌦ (forward delete)
                    - [ ] `CapsLock`
                    - [ ] `Fn`
                    - [ ] `Tab`, 半角全角, カタカナひらがな、変換、無変換、PrtSc/SysRq, NumLk, Ins/Del, BkSp
                - [ ] 同時押し（Ctrl, Shift, Alt, Win, Fn, Metaなど）
                - [ ] 順序押し（vimのヤンクはyyとyを続けて二回押す。モードがある。通常／コマンド／ビジュアル／入力）
            - [ ] マウス
                - [ ] クリック／ダブルクリック（左、中、右）
                - [ ] 長押し（ホールド）
                - [ ] ドラッグ／ドラッグ＆ドロップ
                - [ ] ホイール
                - [ ] チルト（押下、左、右）
                - [ ] 拡張ボタン
                - [ ] トラックボール
            - [ ] タッチパッド／トラックパッド／ペンタブ
                - [ ] タップ／ダブルタップ
                - [ ] 長押し（ホールド）
                - [ ] 拡張ボタン
                - [ ] 筆圧
            - [ ] ゲームパッド
                - [ ] Gamepad API mapping: "standard" ならボタンの物理配置と論理配置が規定だが、""なら未定なので独自マッピングが必要
                - [ ] ボタンの名称や形状も違う
                - [ ] アナログスティックは方向と強度が0〜1までの少数。アイコンで表示するのは不可能なので強弱や八方向など特定数を用意するのが限界。二本あるのも注意。
            - [ ] ジャイロ
                - [ ] 傾き
    - [ ] ⌨キーボード
        - [x] フォーカスループ
        - [ ] 「再び開く」ボタンをEnterキー押下したときページが進んでしまうバグ（スペースキーのときは問題ない。原因不明。ボタンを押したら(`keydown`)`click`が発火するのに、ページ遷移は`keyup`で発火するため。ボタンをキー押下するときのイベントは`keyup`であって欲しい）
        - [ ] `F1`でヘルプを開く
            - [ ] キー／マウス／タッチ／パッドでの操作方法一覧（ページ遷移方法）
            - [ ] 作品概要（表紙を見る）
            - [ ] 感想など反応する（ローカル内。著者SNSへ。自分SNSへ。自分リポジトリへ。）
            - [ ] アプリ概要（Javel概要、特徴一覧、方針一覧、リポジトリURL）
        - [ ] UIとの競合
            - [ ] キー操作でページ遷移するが、`<input>`などのUI要素と干渉してしまう。どう解決するか。
    - [ ] ポインティングデバイス（ジェスチャ（スライド（スワイプ）、長押し））
        - [ ] 🖱マウス
        - [ ] 🖊ペンタブ
        - [ ] 📱タブレット
        - [ ] hammer.jsを使ってジェスチャ実装した
            - [ ] スワイプはテキスト選択と干渉してしまうため、タップ、ダブルタップ、長押しを採用した
                - [x] タップした座標が画面領域の前半か後半かで進むか戻るかを判別する（テキスト選択中は発火しないようにする）
                - [x] 3秒間長押しで最初の画面に戻る
                - [ ] ダブルタップはヘルプ表示（操作方法、作品概要、アプリ概要）
            - [ ] スマホの場合（二本のポインタが使えるデバイスのみ可能なアクション）
                - [ ] ピンチイン／アウトで拡大／縮小する？（ページ分割計算しなきゃで時間がかかるから辞めたほうがいい）
                - [ ] ローテートで縦書き／横書きを切り替える？（ページ分割計算しなきゃで時間がかかるから辞めたほうがいい）
    - [ ] 🎮ゲームパッド（ボタンの物理配置と論理配置が未定義？mapping: "standard"なら既定値がある。）
        - [ ] 空文字なら独自マッピングのため自力でマッピングする必要がある
            - [ ] キーマップ定義用UI作成
    - [ ] マウスカーソル画像
        - [ ] ダークモード時に白くする
        - [ ] 画面より左右半分ならその方向にページを捲ることを示すアイコンにする
        - [ ] 長押し時に発火までの時間と、そのとき発生する処理内容（本を閉じるまであとN秒）をポップアップ表示する。途中で離したらキャンセルされる。
- [ ] HTML
    - [ ] JSON-LDを追加する
- [ ] CSS
    - [ ] `::selection`の色を定義する
- [ ] JS
    - [ ] 
- [ ] 設定画面
    - [ ] 全画面切替
        - [ ] 全画面化サイズに合わせる時は全画面化し、それ以外は解消する
            - [x] `<select>`の`input`イベントによる発火はセキュリティ上の都合で不可能な仕様だった
            - [x] `<閲覧>`ボタンで実行させても全画面化が完了する前にページ計算が実行されてしまうため事前に別操作で拡大させねばならない（アニメ中待機は不可能と思われ）
            - [ ] フルスクリーン切替ボタンを用意する
            - [ ] 現状`ESC`キーで最初の画面に戻るが、全画面化終了キー操作とかぶるため、`BkSp`キーに変更すべき
    - [ ] タイポグラフィ
        - [ ] おまかせ時
            - [ ] UI入力不可にする
            - [ ] サイズに合わせて計算する
                - [ ] 計算した結果をUIに反映させる
    - [ ] フォントファミリ
        - [ ] 適切なフォント名を生成する
            - [ ] OS毎の適切なフォント名を調査する
            - [ ] 現在のOSを取得する
            - [ ] 現在のOSに合わせたフォント名をセットする
        - [ ] UIから任意の優先フォント名を取得する
            - [ ] それをCSSに反映する
    - [ ] フッタ
        - [ ] ノンブル
            -[]有効なフォーマットのパターンを網羅する
- [ ] 新機能追加
    - [ ] 表紙
        - [ ] リンク表示
            - [ ] 作品URL
            - [ ] 著者URL
        - [ ] 暗号資産
            - [ ] Mpurse MONAコイン
            - [ ] 他コインはアドレス表示
        - [ ] シェア(SNS)
    - [ ] Parser
        - [ ] 扉（見開き）ページ
            - [ ] `break-after`/`break-before`
                - [ ] 見出し要素の前後で見出し要素以外のとき、上記CSSを付与するか否か設定できる（作品を通じて共通）
            - [ ] 見出しのみ／短い本文あり（どういうJavel構文にすべきか）
                - [ ] 見出し h1 のみ
                - [ ] 見出しのみ（h1,h2,h3などが連続して登場する場合あり）
                - [ ] 見出しと本文（h1〜h6まであり、pも0個以上ありうる（どこまでを扉ページとするか。一画面サイズを超過した場合はスクロール表示でいいか等））
            - [ ] 扉ページをページ数に含めるか否か（含めるべき：正確なクリック回数。含めないべき：正確な本文のページ数。`isCountTobira:boolean`）
    - [ ] Bundle（ページ分割計算を短縮したり、外部の原稿を包含させてStandAloneファイルを生成する）
        - [ ] Javelファイル（原稿内におけるページ分割位置をフロントマターに保存する。分割時のページ設定も。）
            - [ ] `page.split`キーに`- {bi:0, mi:1}`のように記述する（`bi`:TextBlockIndex, `mi`:テキストブロック内のGrapehemes位置(`m`=Manuscript=原稿。`ti`と区別)）
            - [ ] `page`キーがあるJavelファイルを画面にDnDされたら
                - [ ] ページ設定UIをそれに反映させる
                - [ ] ページ計算は`page.split`によるテキストブロック分割からページ生成するようにする
                - [ ] 但し画面サイズに相応しくないサイズなら無視する（何を基準に相応しいと判断するか。小さすぎ大きすぎ等か？意図的に小さく表示したい場合も有りうるのに?）
        - [ ] HTMLファイル（ページ分割したHTMLを単独動作するHTMLファイルに生成してDLする。Previewerがなくても閲覧できる。但しコード部分が重複する等問題あり）
            - [ ] Fix版（特定のディスプレイやブラウザ上かつ書字方向などで見る場合。それ以外の画面では最適化できない）
            - [ ] Reflow版（原稿だけ包含して都度ページ分割計算するため時間がかかる。ファイルをDnDする手間がない）
            - [ ] DnD
                - [ ] HTMLファイルがDnDされたら
                    - [ ] HTML要素から原稿を復元する
                    - [ ] それをUIの`<textarea>`に表示する
                    - [ ] Fix版なら`page`設定もあるはずなので、それもUIに反映する（その情報をどうHTMLに持たせ、取得可能な形式にするか）
        - [ ] 用語定義
            - [ ] JavelテキストからHTMLを生成する→`Split`でなく`Pagenate`にする
            - [ ] Javelテキストや単一HTMLから見出し要素を基点に複数HTMLファイル分割する→`SplitHtml`（既存小説投稿サイトと同じく一HTMLあたり見出し＋本文の形式）
    - [ ] キー連続入力防止
        - [ ] 次に進む時に連続入力せぬよう一定時間入力禁止する（但し一度も読んだことのない初見ページをどう判定するか。そのために保存機能を使うのはどうか。）
- [ ] 仕様
    - [ ] ライセンス
        - [ ] 公開された作品は「誰もが使える創作目的の素材／著者だけが特権をもつ営利目的の商材」にする
            - [ ] CC0           著作権放棄の表明
            - [ ] CC-BY         表示
            - [ ] CC-BY-SA      表示＆継承
            - [ ] CC-BY-ND      表示＆改変禁止
            - [ ] CC-BY-NC      表示＆営利禁止
            - [ ] CC-BY-NC-SA   表示＆営利禁止＆継承
            - [ ] CC-BY-NC-ND   表示＆営利禁止＆改変禁止
        - [ ] 誰もが使える創作目的の素材（著作権を持ったまま他者が本作品を金儲けの商材にしようと企むことを禁止することを優先することで利権問題を解消する）
            - [ ] CC-BY-NC-SA   表示＆営利禁止＆継承（パクって金儲けしなければ何してもOK。改変したものも同様ライセンスを強要する(ちょい改変での事実上パクり営利も禁止)）
            - [ ] CC-BY-NC-ND   表示＆営利禁止＆改変禁止（パクって金儲けや改変しなければ何してもOK。再配布OK。二次創作NG。パクリ営利NG）
            - [ ] CC0           著作権放棄の表明（著作権放棄。表示せず営利目的ながら©にすることも可能。ようはパクって金儲け可。無責任に利権放棄したせいで営利汚染可）
            - [ ] CC-BY-NC      表示＆営利禁止（パクって金儲けしなければ何してもOK。ちょい改変で©にすれば事実上ほぼパクリ営利可能）
            - [ ] CC-BY         表示（自分の名前だけは表示強要）
            - [ ] CC-BY-SA      表示＆継承（何次創作だろうが全ての原作者を必ず表示する。全著者へのリスペクト）
            - [ ] CC-BY-ND      表示＆改変禁止（二次創作できない。そのまま再配布だけOK）
        - [ ] 著者だけが特権をもつ営利目的の商材（営利とは著者だけが特権を持つことを意味する。他人に自由に利用させない権利とも言う）
            - [ ] ©コピーライト（全著作権を所有する。無断転載など禁止。誰にも何も許可しない）
            - [ ] 実際はネットに公開するとDLされたりパクられたり無断転載されたり想定外の表示方法がされたりデータ抽出されたりする。そのことを理解する必要がある。技術的にコピペが容易な環境にデータを記録されるため、いくら論理的・倫理的な法律に縋っても権力者によって歪められることが頻発している現状、権力者でない人は法律を頼みの綱にしづらいのが現状である
        - [ ] 自由創作を妨害するのに危険なライセンスに以下マークを付ける
            - [ ] ☠ちょい改変営利OK（CC0,CC-BY-NC,CC-BY,CC-BY-SA,CC-BY-ND）
            - [ ] ☠二次創作NG（CC-BY-NC-ND,CC-BY-ND）
        - [ ] 自由創作のために有効なライセンスを厳選する（営利禁止、改変禁止）
            - [ ] CC-BY-NC-SA      x o 改変OKだが営利汚染を禁じれるため自由創作の輪が広がる（パクリや二次創作も同様に営利NG＆改変OKのため）
            - [ ] CC-BY-NC-ND      x x 改変NGのため二次創作できず、営利NGのため営利汚染されず、作品と著者の名誉を保ったまま再配布・拡散が期待できる
            - [ ] CC-BY-ND         o x 営利OKだが改変禁止のため作品はそのままで犯されないし原作者名も表示されるから作品と著者の名誉を保てる
        - [ ] 自由の観点からポジ／ネガでマーキングする
            - [ ] ポジ 自由
                - [ ] 😀 再配布OK
                - [ ] 😀 改変OK（二次創作OK）
                - [ ] 😀 継承
            - [ ] ネガ 束縛
                - [ ] 😨☠営利汚染可(ちょい改変営利可)（CC0,CC-BY-NC,CC-BY,CC-BY-SA,CC-BY-ND）
                - [ ] 😨☠改変NG（二次創作NG）（CC-BY-NC-ND,CC-BY-ND）
            - [] 公平（事実・根拠の追跡性）
                - [ ] 👍👎 全著者名表記（CC-BYだとその二次創作は表記されないため不適切。他にもCC0など著作権放棄したものは著者名表記されない）
                - [ ] 👍👎 原作URL表記（GPL,AGPLのようなソースコード公開義務）
                    - [ ] CC系に加えてソースコード公開義務も付与する。その目的は改変OKと著者表示保証するため。
                        - [ ] 基本的にはGitHubリポジトリURL等。またはそれを含むファイルURL等。

